<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">

<dom-module id="members-material">
  <template>
    <style is="custom-style">
      #cards {
        text-align: center;
      }
      .icon {
        font-size: 23px;
        width: 4em;
        height: 4em;
        line-height: 4em;
        text-align: center;
        border-radius: 2em;
        color: #FFF;
        display: inline-block;
        margin: 0.9em 1.2em 0.8em 1.3em;
        position: relative;
        overflow: hidden;
        background-size: 4em;
      }
      .icon:first-line {
        font-size: 26px;
        font-weight: 700;
      }
      paper-card {
        width: 352px;
        margin: 16px;
        border-radius: 3px;
        list-style-type: none;
        display: inline-block;
        position: relative;
        overflow: hidden;
        box-sizing: border-box;
        text-align: initial;
      }
      .user-name {
        @apply(--paper-font-headline);
        font-size: 20px;
        font-weight: 700;
        line-height: 30px;
        white-space: nowrap;
        display: inline-block;
        position: absolute;
        overflow: hidden;
        text-overflow: ellipsis;
        top: 40px;
        left: 145px;
      }
      .user-nick {
        color: var(--paper-grey-600);
        font-size: 18px;
        font-weight: 400;
        width: 55px;
        height: 10px;
        top: 70px;
        white-space: nowrap;
        position: absolute;
        display: inline-block;
        left: 145px;
      }
      a:link, a:visited {
        text-decoration: none;
        cursor: pointer;
      }
      .inherit {
        color: inherit;
        background-color: inherit;
      }
    </style>

    <iron-ajax auto url="/php/getUsersInfo.php" handle-as="json" last-response="{{data}}"></iron-ajax>
    <div id="cards">
      <template is="dom-repeat" items="{{data}}">
        <paper-card>
          <div class="user-name">{{item.fullname}}</div>
          <div class="user-nick">{{item.nick}}</div>
          <span class="icon" style$="{{getStyle(item)}}">{{getInitials(item)}}</span>
          <div class="card-actions">
            <a href="http://{{item.shortname}}.serben.tk" target="{{item.shortname}}" class="inherit">
              <paper-button class="link">Sito</paper-button>
            </a>
            <a href="{{item.link}}" target="{{item.nick}}" class="inherit">
              <paper-button class="link">Profilo Steam</paper-button>
            </a>
          </div>
        </paper-card>
      </template>
    </template>
    </div>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'members-material',

        existsLogo: function(link) {
          var http = new XMLHttpRequest();
          http.onreadystatechange = function() {
            if (http.readyState === 4) {
              return (http.status === 200) || (window.location.href.indefOf('http') === -1);
            }
          };
          http.open('HEAD', 'logos/' + link + '.png', true);
        },
        getColorFromLetters: function(letters) {
          return '#' + ('000' + letters.charCodeAt(0)).substr(-3, 3) + ('000' + letters.charCodeAt(1)).substr(-3, 3);
        },
        getInitials: function(user) {
          if (user.img)
            return '';
          var arr = user.fullname.split(' ');
          return arr[0][0] + arr[arr.length - 1][0];
        },
        getStyle: function(user) {
          if(user.img)
            return 'background-image: url(' + user.img + ');';
          return 'background-color: ' + this.getColorFromLetters(this.getInitials(user)) + ';';
        }
      });
    })();
  </script>
</dom-module>
